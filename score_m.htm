<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="images/logo/small_logo.ico">
    <title>股票分，给你的股票打个分</title>

    <!-- Bootstrap core CSS -->
    <link href="static/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/jumbotron.css" rel="stylesheet">


    <link rel="stylesheet" type="text/css" href="static/jquery-easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="static/jquery-easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="static/jquery-easyui/demo/demo.css">
    <script src="static/jquery/1.12.4/jquery.min.js"></script>
    <script src="static/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/jquery-easyui/jquery.easyui.min.js"></script>
    <!-- 引入 ECharts 文件 -->
    <script src="static/echarts/js/echarts.min.js"></script>

    <script>
        var quoteServerRootUrl = "https://souhaogu.cn/stock_quote";
        var scoreServerRootUrl = "https://souhaogu.cn/stock_score";
        //var scoreServerRootUrl = "http://localhost:8080/stock_score";
        if (window.location.host != '') {
            var curUrl = window.location.href;
            var curPathName = window.location.pathname;
            var pos = curUrl.indexOf(curPathName);
            serverRootUrl = curUrl.substring(0, pos);
        }

        myloader = function (param, success, error) {
            var q = param.q || '';
            if (q.length < 2) {
                success({});
                return false
            }
            $.ajax({
                url: quoteServerRootUrl + '/stockBasic/getStockBasicsOfLikeStr.do',
                type: "GET",
                dataType: 'json',
                data: {
                    likeStr: q
                },
                success: function (result) {
                    var list = result.result;
                    var items = $.map(list, function (item, index) {
                        return {
                            id: item.stockCode,
                            name: item.stockName + "(" + item.stockCode + ")"
                        };
                    });
                    success(items);
                },
                error: function () {
                    error.apply(this, arguments);
                }
            });
        };

        var myChart;

        myselect = function (param) {
            //初始化
            $("#td_stockCode").html("-");
            $("#td_stockName").html("-");
            $("#td_listDate").html("-");
            $("#td_curPrice").html("-");
            $("#td_safetyScore").html("-");
            if (myChart != null){
                myChart.clear();
            }

            var stockCode = param.id;
            //打印基本信息
            $.ajax({
                url: quoteServerRootUrl + '/stockBasic/getStockBasicByStockCode.do',
                type: "GET",
                dataType: 'json',
                data: {
                    stockCode: stockCode
                },
                success: function (result) {
                    if (result.isSucc) {
                        var stockVo = result.result;
                        $("#td_stockCode").html(stockVo.stockCode);
                        $("#td_stockName").html(stockVo.stockName);
                        var listDateStr = stockVo.listDate;
                        listDateStr = listDateStr.substr(0,4) + "-" + listDateStr.substr(4,2) + "-" + listDateStr.substr(6,2);
                        $("#td_listDate").html(listDateStr);
                    } else {
                        window.alert(result.error);
                    }
                }
            });

            //打印当前行情
            $.ajax({
                url: quoteServerRootUrl + '/realtimeQuote/queryRealtimeQuotes.do',
                type: "GET",
                dataType: 'json',
                data: {
                    stockCode: stockCode,
                    recentlyCount : 1
                },
                success: function (result) {
                    if (result.isSucc) {
                        var dayQuoteVoList = result.list;
                        if (dayQuoteVoList.length >= 1) {
                            $("#td_curPrice").html(dayQuoteVoList[0].avgPrice.toFixed(2));
                        }
                    } else {
                        window.alert(result.error);
                    }
                }
            })


            //打印评分
            $.ajax({
                url: scoreServerRootUrl + '/stockScore/queryScore.do',
                type: "GET",
                dataType: 'json',
                data: {
                    stockCode: stockCode
                },
                success: function (result) {
                    if (result.isSucc) {
                        var scoreVo = result.result;
                        $("#td_safetyScore").html(scoreVo.safetyScore.toFixed(2));
                        setScoreChart(scoreVo);
                    } else {
                        window.alert(result.error);
                    }
                }
            })
        };

        setScoreChart = function (scoreVo) {
            var divChart = window.document.getElementById('div_chart2');
            if (divChart != null) {
                var detailCaption = "股票分";
                var legend_arr = new Array();
                var series_arr = new Array();
//                legend_arr[0] = detailCaption;
                series_arr[0] = {
                    name: detailCaption,
                    value: [scoreVo.safetyScore.toFixed(2), scoreVo.accountScore, scoreVo.directionScore, scoreVo.vitalityScore, scoreVo.eventScore]
                };

                // 基于准备好的dom，初始化echarts实例
                myChart = echarts.init(divChart);

                var option = {
                    title: {
                        text: ''
                    },
                    tooltip: {},
                    legend: {
                        data: legend_arr
                    },
                    radar: {
                        name: {
                            textStyle: {
                                color: '#fff',
                                backgroundColor: '#999',
                                borderRadius: 3,
                                padding: [1, 1],
                                fontSize:8
                            }
                        },
                        nameGap:1,
                        indicator: [
                            {name: '安全分', max: 100.00},
                            {name: '趋势分', max: 100.00},
                            {name: '财务分', max: 100.00},
                            {name: '活跃分', max: 100.00},
                            {name: '事件分', max: 100.00}
                        ]
                    },
                    series: [{
                        name: detailCaption,
                        type: 'radar',
                        // areaStyle: {normal: {}},
                        data: series_arr
                    }]
                };

                // 使用刚指定的配置项和数据显示图表
                myChart.setOption(option);
            }
        }
    </script>
</head>

<body>
    <div id="stock_code" class="row">
        <div class="col-lg-5 col-md-5 col-xs-2"></div>
        <!--<div class="input-group col-lg-3 col-md-3 col-xs-3" style="margin-top:0px positon:relative margin-bottom:20px">-->
        <div class="input-group col-lg-2 col-md-2 col-xs-8">
            <input id="selectStock" class="easyui-combobox bs-searchbox form-control"
                   title="请输入股票代码/简拼/全名"
                   placeholder="请输入股票代码/简拼/全名"
                   data-options="loader: myloader,
                        onSelect:myselect,
                        mode: 'remote',
                        valueField: 'id',
                        textField: 'name'"/>
        </div>
        <div class="col-lg-5 col-md-5 col-xs-2"></div>
    </div>
    <br>
    <div class="row">
        <div class="col-lg-4 col-md-3 col-xs-1"></div>
        <div class="col-lg-4 col-md-6 col-xs-10">
            <table class="table table-bordered">
                <tr><td colspan="2"><b>基本信息</b></td></tr>
                <tr><td>股票代码</td><td id="td_stockCode">-</td></tr>
                <tr><td>股票名称</td><td id="td_stockName">-</td></tr>
                <tr><td>上市日期</td><td id="td_listDate">-</td></tr>
                <tr><td>当前股价</td><td id="td_curPrice">-</td></tr>
                <tr><td colspan="2"><b>股票分</b></td></tr>
                <tr><td>安全分</td><td id="td_safetyScore">-</td></tr>
                <tr><td>财务分</td><td id="td_accountScore">即将推出</td></tr>
                <tr><td>趋势分</td><td id="td_directionScore">即将推出</td></tr>
                <tr><td>活跃分</td><td id="td_vitalityScore">即将推出</td></tr>
                <tr><td>事件分</td><td id="td_eventScore">即将推出</td></tr>
                <tr><td>综合得分</td><td id="td_totalScore">即将推出</td></tr>
                <tr><td colspan="2">备注：分值范围为0至100之间，分值最高越好，60分为及格分，分值建议仅代表本方观点，不作投资建议！投资有风险，入市需谨慎。</td></tr>
                <tr><td colspan="2"><div id="div_chart2" style="height:250px;"></div></td></tr>
            </table>
        </div>
        <div class="col-lg-4 col-md-3 col-xs-1"></div>
    </div>
</body>
</html>
